
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../02_cors_demo/">
      
      
        <link rel="next" href="../04_api_endpoints/">
      
      <link rel="icon" href="../../assets/favicon.svg">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-9.1.21">
    
    
      
        <title>03 Data Modeling - HackDuke 2023 Backend Workshop</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.eebd395e.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-8P4LHFQ3PG"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-8P4LHFQ3PG",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-8P4LHFQ3PG",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>

  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#03-data-modeling" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="HackDuke 2023 Backend Workshop" class="md-header__button md-logo" aria-label="HackDuke 2023 Backend Workshop" data-md-component="logo">
      
  <img src="../../assets/hd-symbol.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            HackDuke 2023 Backend Workshop
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              03 Data Modeling
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="HackDuke 2023 Backend Workshop" class="md-nav__button md-logo" aria-label="HackDuke 2023 Backend Workshop" data-md-component="logo">
      
  <img src="../../assets/hd-symbol.svg" alt="logo">

    </a>
    HackDuke 2023 Backend Workshop
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Backend Workshop
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Lab
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Lab
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../00_prerequisites/" class="md-nav__link">
        00 Prerequisites
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../01_git_basics/" class="md-nav__link">
        01 Git Basics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../02_cors_demo/" class="md-nav__link">
        02 CORS Demo
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          03 Data Modeling
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        03 Data Modeling
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#goals" class="md-nav__link">
    Goals
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#entity-relationships" class="md-nav__link">
    Entity relationships
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mapping-database-records-to-python-objects" class="md-nav__link">
    Mapping database records to Python objects
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tweak-the-model-and-migrate" class="md-nav__link">
    Tweak the model and migrate
  </a>
  
    <nav class="md-nav" aria-label="Tweak the model and migrate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add-severity-field" class="md-nav__link">
    Add severity field
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#migrate-changes" class="md-nav__link">
    Migrate changes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#django-admin" class="md-nav__link">
    Django Admin
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#querysets" class="md-nav__link">
    Querysets
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../04_api_endpoints/" class="md-nav__link">
        04 API Endpoints
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#goals" class="md-nav__link">
    Goals
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#entity-relationships" class="md-nav__link">
    Entity relationships
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mapping-database-records-to-python-objects" class="md-nav__link">
    Mapping database records to Python objects
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tweak-the-model-and-migrate" class="md-nav__link">
    Tweak the model and migrate
  </a>
  
    <nav class="md-nav" aria-label="Tweak the model and migrate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add-severity-field" class="md-nav__link">
    Add severity field
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#migrate-changes" class="md-nav__link">
    Migrate changes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#django-admin" class="md-nav__link">
    Django Admin
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#querysets" class="md-nav__link">
    Querysets
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="03-data-modeling">03 Data Modeling</h1>
<h2 id="goals">Goals</h2>
<p>In this lab we are going to:</p>
<ul>
<li>Gain an understanding of how Django's Object Relational Mapper works</li>
<li>Modify the data model</li>
<li>Create some data with Django Admin</li>
</ul>
<h2 id="entity-relationships">Entity relationships</h2>
<p>When building an API it's important to get your data model right early on. 
Unwinding mistakes down the road is difficult. Because it's hard to theorize 
an entire problem space, start small and iterate as you learn more.</p>
<p><em>Entity</em> is a fancy synonym for <em>noun</em> or <em>object</em>. We use them to model the 
relationships between things. For our API we have a simple data model that 
lets <em>users</em> configure <em>weather alerts</em>.</p>
<pre class="mermaid"><code>erDiagram
  User {
    int id PK
    string username
  }
  WeatherAlertConfig {
    int id PK
    int user_id FK
    string state_abbreviation "The state where we want to see alerts"
    enum severity "NEW! You're going to add me"
  }
  User ||--o{ WeatherAlertConfig : "has many"</code></pre>
<p>A couple of notes on the diagram:</p>
<ul>
<li>Each <em>entity</em> has an <code>id</code> field that represents its <em>primary key</em>. Django will 
  automatically assign this to every model you create.</li>
<li><code>WeatherAlertConfig</code> has a <code>user_id</code> <em>foreign key</em> that points back to the 
  owning <code>User</code>. This forms a many-to-one relationship.</li>
</ul>
<p>Our job today will be to add the new <code>severity</code> field to the
<code>WeatherAlertConfig</code>.</p>
<h2 id="mapping-database-records-to-python-objects">Mapping database records to Python objects</h2>
<p>Django comes with an Object Relational Mapper (<a href="https://docs.djangoproject.com/en/4.2/topics/db/models/">docs</a>). It allows 
us to <em>model</em> database tables as Python objects, and then automatically generate
the necessary changes in the database to store data.</p>
<div class="admonition aside">
<p class="admonition-title">Aside</p>
<p>It's hard to talk about data modeling without talking about SQL. Knowing SQL
will make you a better backend developer. Unfortunately we don't have time
to cover it today. In your free time check out a tutorial like 
<a href="https://www.sqltutorial.org/">sqltutorial.org</a>.</p>
</div>
<p>Let's look at the model for our <code>WeatherAlertConfig</code> entity, which lives in 
<a href="https://github.com/johnjameswhitman/hackduke2023backend/blob/04994ecc88fb764bc731e2b34fc2b3551eb20d03/weather/models.py#L5-L9"><code>weather/models.py</code></a>.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">WeatherAlertConfig</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Configuration for an alert that a user is interested in.&quot;&quot;&quot;</span>

    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">state_abbreviation</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="c1"># TODO: below we&#39;ll add severity!</span>
</code></pre></div>
<p>This model maps onto the entity diagram above. A couple of things to note:</p>
<ul>
<li><code>user</code> is a <code>ForeignKey</code> onto the <code>User</code> model. Django will automatically 
  create the underlying <code>user_id</code> foreign key in the table, and will make the 
  related <code>User</code> object available at this property on instances of the model.</li>
<li>We don't need to specify an <code>id</code> primary key, because the underlying 
  <code>models.Model</code> base-class adds it for us.</li>
<li>Use descriptive names for your fields. For example, <code>state</code> may be 
  confusing because it's not clear whether it's the full-state, or just the 
  two-letter <code>state_abbreviation</code> like we've indicated.</li>
</ul>
<h2 id="tweak-the-model-and-migrate">Tweak the model and migrate</h2>
<p>Right now, our users can tell the API which states they're interested in
getting weather alerts for, but the National Weather Service API that we rely 
upon offers a few more things we can use to filter alerts. To see what's 
available go to the <a href="https://www.weather.gov/documentation/services-web-api#/default/alerts_query"><em>National Weather Service API docs</em></a> &gt; Specification &gt; 
expand <code>GET /alerts</code>.</p>
<p>After consulting with users, we've found out they would also like to include 
the <code>severity</code> field to avoid being inundated with low risk alerts. This is 
an <code>enum</code> field, which means it can hold one of a set number of values:</p>
<ul>
<li><code>Extreme</code></li>
<li><code>Severe</code></li>
<li><code>Moderate</code></li>
<li><code>Minor</code></li>
<li><code>Unknown</code></li>
</ul>
<h3 id="add-severity-field">Add <code>severity</code> field</h3>
<p>Let's wire this new <code>severity</code> field into the model.</p>
<ol>
<li>Open <a href="https://github.com/johnjameswhitman/hackduke2023backend/blob/04994ecc88fb764bc731e2b34fc2b3551eb20d03/weather/models.py#L5-L9"><code>weather/models.py</code></a>.</li>
<li>Add a new class above <code>WeatherAlertConfig</code> with the following:
    <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Severity</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">TextChoices</span><span class="p">):</span>
    <span class="n">EXTREME</span> <span class="o">=</span> <span class="s2">&quot;Extreme&quot;</span>
    <span class="n">SEVERE</span> <span class="o">=</span> <span class="s2">&quot;Severe&quot;</span>
    <span class="n">MODERATE</span> <span class="o">=</span> <span class="s2">&quot;Moderate&quot;</span>
    <span class="n">MINOR</span> <span class="o">=</span> <span class="s2">&quot;Minor&quot;</span>
    <span class="n">UNKNOWN</span> <span class="o">=</span> <span class="s2">&quot;Unknown&quot;</span>
</code></pre></div></li>
<li>Now, add a new field to the <code>WeatherAlertConfig</code> model that maps the <em>text 
   choices</em> to a column in the database:
    <div class="highlight"><pre><span></span><code><span class="n">severity</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
    <span class="n">max_lenth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">choices</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">choices</span><span class="p">,</span>
    <span class="c1"># Below options allow users to omit a severity if they want everything.</span>
    <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div></li>
</ol>
<p>Afterward, <code>weather/models.py</code> should look similar to below:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>


<span class="k">class</span> <span class="nc">Severity</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">TextChoices</span><span class="p">):</span>
    <span class="n">EXTREME</span> <span class="o">=</span> <span class="s2">&quot;Extreme&quot;</span>
    <span class="n">SEVERE</span> <span class="o">=</span> <span class="s2">&quot;Severe&quot;</span>
    <span class="n">MODERATE</span> <span class="o">=</span> <span class="s2">&quot;Moderate&quot;</span>
    <span class="n">MINOR</span> <span class="o">=</span> <span class="s2">&quot;Minor&quot;</span>
    <span class="n">UNKNOWN</span> <span class="o">=</span> <span class="s2">&quot;Unknown&quot;</span>


<span class="k">class</span> <span class="nc">WeatherAlertConfig</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Configuration for an alert that a user is interested in.&quot;&quot;&quot;</span>

    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">state_abbreviation</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">severity</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="n">Severity</span><span class="o">.</span><span class="n">choices</span><span class="p">,</span>
        <span class="c1"># Below options allow users to omit a severity if they want everything.</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
<h3 id="migrate-changes">Migrate changes</h3>
<p>At this point we've made changes to our data model, but need to reflect those 
changes into the database. This is where <em>migrations</em> come into play. Django 
will inspect your models and the set of migrations, and then generate a new 
migration that closes any gaps between the two. To do this we'll use
management commands with Django.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># diff weather/models.py and tables</span>
docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>hackduke_django<span class="w"> </span>python<span class="w"> </span>manage.py<span class="w"> </span>makemigrations

<span class="c1"># apply changes</span>
docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>hackduke_django<span class="w"> </span>python<span class="w"> </span>manage.py<span class="w"> </span>migrate
</code></pre></div>
<h2 id="django-admin">Django Admin</h2>
<p>Now that we've modeled our changes and applied them to the database, let's 
see what it looks like:</p>
<ol>
<li>
<p>Navigate to Django Admin and log in with your superuser (admin) if necessary:
   <a href="http://127.0.0.1:8000/admin">http://127.0.0.1:8000/admin</a></p>
<p><img alt="Admin home" src="admin_home.png" title="admin home" /></p>
</li>
<li>
<p>Click on <a href="http://127.0.0.1:8000/admin/weather/weatheralertconfig/"><em>Weather alert configs</em></a>
   and then <em>ADD WEATHER ALERT CONFIG</em> (top right)</p>
<p><img alt="Weather alert config" src="admin_weather_alert_config.png" /></p>
</li>
<li>
<p>Populate and save the alert (note that it automagically includes a dropdown 
   for <code>severity</code>)</p>
<p><img alt="Add weather alert config" src="admin_weather_alert_config_add.png" /></p>
</li>
<li>
<p>The new alert appears in the list</p>
<p><img alt="Weather alert config list" src="admin_weather_alert_config_list.png" /></p>
</li>
</ol>
<h2 id="querysets">Querysets</h2>
<p>In Django, <code>querysets</code> are objects that build up a query to the database. 
This lets you do things like construct a set of filters using inputs from 
different places.</p>
<p>To see them in action, check out weather-alerts list endpoint in
<a href="https://github.com/johnjameswhitman/hackduke2023backend/blob/234d647babba5e3dadbbb90edb6b4ba7046d5b3c/weather/views.py#L38-L40"><code>weather/views.py</code></a>, specifically the last line of this function:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/alerts&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="nb">list</span><span class="p">[</span><span class="n">WeatherAlertResponse</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">list_weather_alerts</span><span class="p">(</span><span class="n">request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">WeatherAlertConfig</span><span class="p">]:</span>
    <span class="k">return</span> <span class="n">WeatherAlertConfig</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">auth</span><span class="p">)</span>
</code></pre></div>
<p><code>WeatherAlertConfig.objects</code> returns a <code>queryset</code>. That itself has a <code>.filter()</code>
method we use to restrict the list of alerts to the current user. You can 
chain these together and pass them around. This is simple example; see the 
<a href="https://docs.djangoproject.com/en/4.2/topics/db/queries/#retrieving-specific-objects-with-filters">official Django querying docs</a> for more complex ones.</p>


  



  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        Was this page helpful?
      </legend>
      <div class="md-feedback__inner">
        <div class="md-feedback__list">
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page was helpful" data-md-value="1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5 9v12H1V9h4m4 12a2 2 0 0 1-2-2V9c0-.55.22-1.05.59-1.41L14.17 1l1.06 1.06c.27.27.44.64.44 1.05l-.03.32L14.69 8H21a2 2 0 0 1 2 2v2c0 .26-.05.5-.14.73l-3.02 7.05C19.54 20.5 18.83 21 18 21H9m0-2h9.03L21 12v-2h-8.79l1.13-5.32L9 9.03V19Z"/></svg>
            </button>
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page could be improved" data-md-value="0">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 15V3h4v12h-4M15 3a2 2 0 0 1 2 2v10c0 .55-.22 1.05-.59 1.41L9.83 23l-1.06-1.06c-.27-.27-.44-.64-.44-1.06l.03-.31.95-4.57H3a2 2 0 0 1-2-2v-2c0-.26.05-.5.14-.73l3.02-7.05C4.46 3.5 5.17 3 6 3h9m0 2H5.97L3 12v2h8.78l-1.13 5.32L15 14.97V5Z"/></svg>
            </button>
          
        </div>
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              
              
                
              
              Thanks for your feedback!
            </div>
          
            <div data-md-value="0" hidden>
              
              
                
              
              Thanks for your feedback! Help us improve this page by using our <a href="https://github.com/johnjameswhitman/hackduke2023backend/issues/new/?title=[Feedback]+03%20Data%20Modeling+-+/lab/03_data_modeling/" target="_blank" rel="noopener">feedback form</a>.
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>


                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../02_cors_demo/" class="md-footer__link md-footer__link--prev" aria-label="Previous: 02 CORS Demo" rel="prev">
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                02 CORS Demo
              </div>
            </div>
          </a>
        
        
          
          <a href="../04_api_endpoints/" class="md-footer__link md-footer__link--next" aria-label="Next: 04 API Endpoints" rel="next">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                04 API Endpoints
              </div>
            </div>
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.footer"], "search": "../../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.220ee61c.min.js"></script>
      
    
  </body>
</html>